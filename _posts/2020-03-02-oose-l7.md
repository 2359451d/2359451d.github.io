---
layout: post
title: OOSE LECTURE 7 - è®¾è®¡æ¨¡å¼ - ç»„åˆ
date: 2020-03-02
excerpt: "è½¯å·¥ - è®¾è®¡æ¨¡å¼, Composition Design Pattern"
tags: [è¯¾é¢˜, code, è½¯ä»¶å·¥ç¨‹, 2020, oose, è®¾è®¡æ¨¡å¼]
feature: https://previews.123rf.com/images/karpenkoilia/karpenkoilia1709/karpenkoilia170900117/86423976-modern-line-web-concept-for-programming-linear-web-banner-for-coding-.jpg
comments: true
---

* ç›®å½•
{:toc}

TODO: æœªæ‰©å±•

ğŸ¬ ç›®æ ‡
- ç†è§£ç»„åˆè®¾è®¡æ¨¡å¼ä¸­å‡ºç°çš„é—®é¢˜
- ç†è§£å¦‚ä½•åº”ç”¨ç»„åˆè®¾è®¡æ¨¡å¼ã€**éœ€æ±‚:ä½“ç°éƒ¨åˆ†ä¸æ•´ä½“å±‚æ¬¡ç»“æ„æ—¶ï¼Œå¸Œæœ›ç”¨æˆ·å¿½ç•¥ç»„åˆå¯¹è±¡&å•ä¸ªå¯¹è±¡çš„ä¸åŒå—ï¼Œç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‘**
- ç»„åˆè®¾è®¡æ¨¡å¼ç»“æ„

---

## RECAP: Strucutal Pattern

![](/static/2020-03-03-01-58-25.png)
![](/static/2020-03-03-01-58-32.png)

## Problem: Products and Boxes

![](/static/2020-03-02-23-39-59.png)
- å‡è®¾ä¸¤ç§å¯¹è±¡: äº§å“products&ç®±å­boxes
  - æ¯ä¸ªboxå¯ä»¥åŒ…æ‹¬å¤šä¸ªproducts&boxes
- å‡è®¾è®¾è®¡ä¸€ä¸ªè®¢å•æœåŠ¡ç³»ç»Ÿè®¾è®¡è¿™ä¸¤ä¸ªç±»ã€‚æ¯ä¸ªOrder(ç±»)ä¸­çš„productå¯é€‰æœ‰æ— box
- å¦‚ä½•è®¡ç®—æ¯ä¸ªOrderå¯¹è±¡çš„total price?

### Solution 1

![](/static/2020-03-03-01-53-27.png)
- å»é™¤æ‰€æœ‰box, è®¡ç®—æ‰€æœ‰productä»·æ ¼
- å®ç°ç¼ºé™·

### Solution 2

![](/static/2020-03-03-01-54-32.png)
- productå’Œboxå®ç°å…±åŒæ¥å£, è¯¥æ¥å£å£°æ˜è®¡ç®—total priceçš„æ–¹æ³•

ğŸŠ å®ç°åŸç†
![](/static/2020-03-03-02-01-12.png)
- **æ‰€æœ‰å¯¹è±¡**å½¢æˆçš„æ ‘çŠ¶ç»“æ„ä¸­,é€’å½’åœ°å®ç°æŸè¡Œä¸º

## Composite Pattern

### Definition

![](/static/2020-03-03-02-03-35.png)
- ç»“æ„å‹è®¾è®¡æ¨¡å¼: å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„ï¼Œä½¿ç”¨æˆ·å¯¹æ‰€æœ‰å¯¹è±¡(å•ä¸ªæˆ–ç»„åˆ)å…·æœ‰ä¸€è‡´è®¿é—®æ€§ã€‚
  - ç»„åˆå¯¹è±¡ä¹Ÿä½œä¸ºå•ä¸€å¯¹è±¡å¯¹å¾…

### Deal with Structures and Hierarchies

![](/static/2020-03-03-02-10-10.png)
- é€šå¸¸å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„è¿›è¡Œé—®é¢˜åˆ†æ

### Problem

![](/static/2020-03-03-02-37-37.png)
![](/static/2020-03-03-02-38-27.png)
- éœ€è¦å¤„ç† å•ä¸ªå¯¹è±¡ & ç»„åˆå¯¹è±¡
  - å¤„ç†æ–¹å¼ä¸åŒ
  - å¦‚æœå¤„ç†ä¹‹å‰,æ ¹æ®**å®é™…ç±»å‹**åˆ¤æ–­é‡‡å–ä¸åŒè¡Œä¸ºæ•ˆç‡ä½

ğŸŠ è€ƒè™‘: ä¸é€šè¿‡ç¡®è®¤å¯¹è±¡å®é™…ç±»å‹è€Œé‡‡å–è¡Œä¸º

### Example: The Computer File System

ğŸ¬ å¤„ç† Directory & Fileå¯¹è±¡, 
- file system(folder)æ ¹ç›®å½•'/'
- åŒ…å«å¤šä¸ªentry


![](/static/2020-03-03-02-43-34.png)
![](/static/2020-03-03-02-47-27.png)
- txt
- binaryfile(äºŒè¿›åˆ¶æ–‡ä»¶,æ•´å‹åºåˆ—)
- shortcut
- folder

---
ğŸŠ è¯¥ä¾‹å­ä¸­, file(entry)ä¸ºå•ä¸ªå¯¹è±¡ï¼Œfolderä¸ºç»„åˆå¯¹è±¡

- è¯¥systemå†…æ ‘çŠ¶å±‚æ¬¡ç»“æ„çš„å¶å­(folder entry)å®šä¹‰å¦‚ä¸‹

```java
// leaf: binary file entry
public class BinaryFile{
  String name;
  // åˆ¤æ–­ç±»å‹
  public static final String TYPE = ".exe";
  
  public BinaryFile(String name){
    this.name =name;
  }

  public void ls(){
    System.out.println(CompositeDemo.compositeBuilder+name+TYPE);
  }

}

// Lead: txt file
public class TextFile{
  String name;
  public static final String TYPE = ".txt";

  public TextFile(String name){
    this.name = name;
  }

  public void ls(){
    System.out.println(CompositeDemo.compositeBuilder+name+TYPE);
  }
}

// shortcut
public class Shortcut {
  public Object link;
  String name;
  public static final String TYPE = ".shortcut";

  public Shortcut(String name, Object link) {
    this.name = name;
    this.link = link;
  }

  public void ls() {
    String linkType = "";
    if(link instanceof TextFile)
      linkType = TextFile.TYPE;
    else if(link instanceof BinaryFile) 
      linkType = BinaryFile.TYPE;
    else if(link instanceof Folder)
      linkType = Folder.TYPE;
    //...
    System.out.println(CompositeDemo.compositeBuilder + name+linkType+TYPE);
  }
}

public class Folder {
  String name;
  public static final String TYPE = "/";
  private ArrayList<Object> includedFiles = new ArrayList<Object>();

  public Folder(String name) {
    this.name = name;  
  }

  public Object find(String name) {
    Object ans = null;
    for(Object o:includedFiles) {
      String name1 = null;
      if(o instanceof BinaryFile) 
        name1 = ((BinaryFile) o).name;
      else if(o instanceof TextFile)
        name1 = ((TextFile) o).name;
      else if(o instanceof Shortcut)
        name1 = ((Shortcut) o).name;
      else if(o instanceof Folder)
        name1 = ((Folder) o).name;

      if(name1.equals(name)) {
        ans = o;
        break;
      }
    }
    return ans;
  }

  public void add(Object e) { 

    if(!includedFiles.contains(e)) {
      includedFiles.add(e);
    }
  }

  public void ls() {
    System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
    CompositeDemo.compositeBuilder.append("   ");
    for (Object obj : includedFiles) {
      // Recover the type of this object
      String name = obj.getClass().getSimpleName();
      if (name.equals("BinaryFile")) {
        ((BinaryFile)obj).ls();
      } 
      else if (name.equals("TextFile")) {
        ((TextFile)obj).ls();
      }
      else if (name.equals("Shortcut")) {
        ((Shortcut)obj).ls();
      }
      else if (name.equals("Folder")) {
        ((Folder)obj).ls();
      }
    }
    CompositeDemo.compositeBuilder.setLength(CompositeDemo.compositeBuilder.length() - 3);
  }
```

ğŸŠ æ¨¡æ‹ŸClient
![](/static/2020-03-03-03-13-34.png)

#### Problem & Solution in Example

![](/static/2020-03-03-03-14-41.png)
- è€¦åˆæ€§é«˜, ä¸åŒç±»å‹å¯¹è±¡è¡¨ç°ä¸åŒè¡Œä¸ºä¹‹å‰éœ€è¦è¿›è¡Œå¤šæ¬¡ç±»å‹åˆ¤æ–­
- æ–°å¢å¯¹è±¡ç±»å‹, å½±å“å…¶ä»–å­˜åœ¨å¯¹è±¡ç±»

---
ğŸŠ å¦‚ä½•åŒä¸€å¤„ç†ä¸åŒç±»å‹å¯¹è±¡?

ğŸ¬Solution
- ä¸åŒEntryç±»å‹å®ç°å…±åŒæŠ½è±¡ç±»

![](/static/2020-03-03-03-22-13.png)

ğŸ¬ æŠ½è±¡ç±»: AbstractFile

```java
public abstract class AbstractFile {
	String name;

	public abstract void ls();
	public abstract String getType();	
	public void add(AbstractFile f) {}
}

```

ğŸ¬ Entryç»§æ‰¿æŠ½è±¡ç±»
- BinaryFile

```java
public class BinaryFile extends AbstractFile{
	public static final String TYPE = ".exe";
	
	public BinaryFile(String name){
	      this.name = name; 
    }
	
	@Override
	public String getType() {
		return TYPE;
	}
	
	@Override
	public void ls() {
	   System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
	}
}
```

- TextFile

```java
public class TextFile extends AbstractFile{
	public static final String TYPE = ".txt";
	
    public TextFile(String name){
      this.name = name;  // stores the name in the class Entry part of this object
    }

    @Override
	public String getType() {
		return TYPE;
	}
    
    @Override
    public void ls() {
 	   System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
 	}
}
```

- Shortcut

```java
public class Shortcut extends AbstractFile{
	//models a link (shortcut) to an Entry not in the present folder/level
public AbstractFile link;

public static final String TYPE = ".shortcut";


	public Shortcut(String name, AbstractFile link) {
		this.name = name;
		this.link = link;
	}
	
	@Override
	public String getType() {
		return TYPE;
	}
	
	@Override
	public void ls() {
		System.out.println(CompositeDemo.compositeBuilder + name+link.getType()+TYPE);
	}
}

```

- Folder

```java
public class Folder extends AbstractFile{
	public static final String TYPE = "/";

    private ArrayList<AbstractFile> includedFiles = new ArrayList<AbstractFile>();

	public Folder(String name) {
		this.name = name;  
		includedFiles = new ArrayList<AbstractFile>();  
	}

	public AbstractFile find(String name) {
		AbstractFile ans = null;
		for(AbstractFile af:includedFiles) {
			if(af.name.equals(name)) {
				ans = af;
				break;
			}
		}
		return ans;
	}

	public void add(AbstractFile e) { 		
		if(!includedFiles.contains(e)) {
			includedFiles.add(e);
		}
	}

	@Override
	 public void ls() {
	        System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
	        CompositeDemo.compositeBuilder.append("   ");
	        for (AbstractFile as : includedFiles) {
	        		as.ls();
	        }
	        CompositeDemo.compositeBuilder.setLength(CompositeDemo.compositeBuilder.length() - 3);
	    }

	@Override
	public String getType() {
		return TYPE;
	}

}
```

- Client

![](/static/2020-03-03-03-27-01.png)


### Structure of Composite Pattern

ğŸŠ ç±»å›¾
![](/static/2020-03-03-03-27-59.png)
- å¶(å•ç‹¬å¯¹è±¡) & ç»„åˆå¯¹è±¡å…±åŒå®ç°åŒä¸€æŠ½è±¡ç±»Component

ğŸ¬ Component æŠ½è±¡ç±»
![](/static/2020-03-03-03-29-42.png)
- å®ç°é»˜è®¤è¡Œä¸º
- å£°æ˜ç®¡ç†&è®¿é—®å„å¯¹è±¡çš„æ–¹æ³•
- å¯é€‰, é€’å½’ç»“æ„ä¸­è®¿é—®çˆ¶ç±»ç»“ç‚¹çš„æ–¹æ³•

ğŸ¬ Leaf: å¶ï¼Œå•ä¸ªå®ç°ç±»
![](/static/2020-03-03-03-38-27.png)

ğŸ¬ Composite: ç»„åˆå¯¹è±¡
![](/static/2020-03-03-03-40-24.png)
- å¯ä»¥æœ‰å­å¯¹è±¡
- å®ç°äº†æŠ½è±¡æ¥å£ä¸­å­å¯¹è±¡ç›¸å…³æ“ä½œ

ğŸ¬ Client
![](/static/2020-03-03-03-41-25.png)
- ä¸€è‡´å¤„ç†å¯¹è±¡(æ— éœ€å…³å¿ƒå¤„ç†çš„å¯¹è±¡ç±»å‹)ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç 

### ğŸ™Single-dispatch

![](/static/2020-03-03-03-46-00.png)
- å¤šæ€: è°ƒç”¨Componentæ„å»ºçš„operation()ï¼Œ**æœ€åçš„è¡Œä¸ºè¡¨ç°å–å†³äºcomponentç±»å‹**
  - Leaf or Composite

### Advantages & Disadvantages

![](/static/2020-03-03-03-50-11.png)
ğŸŠ ç»„åˆæ¨¡å¼ä¼˜ç‚¹
- æ ‘çŠ¶å±‚æ¬¡ç»“æ„,åŒ…å«åŸºæœ¬æ„ä»¶&ç»„åˆæ„å»ºå¯¹è±¡
- ç®€åŒ–å®¢æˆ·ç«¯ä»£ç 
- æ˜“äºæ–°å¢ç‰¹å®šæ„å»ºï¼Œ**ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œé™ä½è€¦åˆ**
  - ä¸ç”¨é¢å¤–ä¿®æ”¹æºç 

<font color="red">ç”¨æˆ·ä¸ç”¨å…³å¿ƒå¤„ç†çš„åˆ°åº•æ˜¯å¶èŠ‚ç‚¹è¿˜æ˜¯ç»„åˆç»„ä»¶ï¼Œä¸ç”¨ä¸ºå®šä¹‰ç»„åˆè€Œå†™åˆ¤æ–­è¯­å¥</font>
- å³ï¼Œè®©ç”¨æˆ·ä¸€è‡´è®¿é—®ä½¿ç”¨ç»„åˆå’Œå•ä¸ªå¯¹è±¡

ğŸŠ ç¼ºç‚¹
- è®¾è®¡è¿‡äºç¬¼ç»Ÿ

## Summary

![](/static/2020-03-03-03-50-26.png)
- ç»“æ„å‹æ¨¡å¼: ç»„åˆè®¾è®¡æ¨¡å¼
  - ç±»ä¸å¯¹è±¡å¦‚ä½•ç»„åˆï¼Œå½¢æˆæ›´å¤§çš„ç»“æ„
- åˆ©äºç»„ç»‡å¯¹è±¡å½¢æˆæ ‘çŠ¶å±‚æ¬¡ç»“æ„