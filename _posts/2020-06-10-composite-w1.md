---
layout: post
title: "Cousera笔记 - 计算机组成1 · 计算机基本结构"
date: 2020-06-10
excerpt: "冯·诺伊曼结构，计算机执行指令的过程..."
tags: [学习笔记, coursera, 计算机组成, 2020]
feature: https://www.gla.ac.uk/media/Media_299663_smxx.jpg
comments: true
---

[参考课程 - 计算机组成](https://www.coursera.org/learn/jisuanji-zucheng/home/week/2)

* 目录
{:toc}

## 冯·诺依曼结构的要点

🍊 Key points of von Neumann structure

![](/static/2020-06-11-00-15-45.png)

> 关于EDVAC的报告草案，**主要论述2个重要思想**
>
> 1. 控制计算机的**程序应存放在存储器中**(而不是开关连线实现,降低运行效率)
> 2. 计算机**应采用二进制**(十进制会导致内部结构复杂)

🍉 要点归纳

![](/static/2020-06-12-00-16-54.png)

🍬 这份报告还明确了计算机内部结构由**五个部分组成**

* 运算器(中央算术运算) - CA: central arithmetical
* 控制器(中央控制) - CC: central control
* 存储器 - M: memory
* 输入设备 - I: input
* 输出设备 - O: output

🍙 注意： <font color="blue">外部存储介质</font>，如硬盘，bios芯片等，<font color="blue">不属于存储器范畴</font>

🍬 数据&程序 - <font color="blue">二进制代码形式，不加区别存放在存储器中</font>，存放位置由存储器的地址指定

🍬 计算机工作时，<font color="blue">自动从存储器中取出指令加以执行</font>

---

🍊 了解这五个组成部分的例子 - 世界上第一个商业微处理器【intel 4004】

![](/static/2020-06-11-00-29-21.png)

> 它的面积很小，采用10μm制造工艺
>
> 内部晶体管2250个，max主频740KHz，字长4bit

* 对比现代，各项指标都非常落后.
  * 现代微处理器可达10nm量级，内部晶体管数量可达数十亿
  * 主频提高几千倍，字长通常32/64 bit

🍬 intel 4004 最初应用不在制造计算机

![](/static/2020-06-11-13-05-03.png)

🍙 <font color="blue">4001/2/3/4共同构成MCS-4</font>

🍬 MCS-4芯片组 · 计算器实现
* 4001 - 只读存储器ROM
  * 断电不易失
* 4002 - 随机存储器RAM
  * 快速读写，断电易失
* 4003 - 移位寄存器芯片
  * 负责I/O

---

🍬 MCS-4芯片组 · 另一种计算器实现

![](/static/2020-06-11-15-12-44.png)

> 该结构非计算机实现，但与冯诺依曼结构有对应关系

* 4004 - 微处理器/CPU
  * 运算器 & 控制器
* 4002 - 随机存储器RAM
* 两片4003芯片 - 输入输出设备
  * 4003接键盘 - INPUT
  * 4003接打印机 - OUTPUT

### 冯诺依曼结构核心

🍊 the Core of Von Neumman Structures

![](/static/2020-06-11-23-16-41.png)
![](/static/2020-06-12-00-04-32.png)

* 运算器CA & 控制器 CC - a.k.a **C**
  * 对应现代计算机**CPU**
* 存储器M
  * 主存储器(主存，内存)

🍬 <font color="purple">CPU & 主存储器通过系统总线(<b>控制，地址，数据总线</b>)连接</font>

### 主存的组织形式

![](/static/2020-06-12-00-10-25.png)

* 地址: 每个存储单元对应的序号
* 内容: 存储单元中存放的信息(指令&数据)
  * 现代计算机，一般一个存储单元存放8bit

🍬 指令(程序)&数据不加区分存放，提高效率

### 计算过程

![](/static/2020-06-12-00-16-54.png)

> 程序&数据通过I设备进入存储器
>
> 控制器发地址给主存储器(通过控制逻辑)，**获取指令&数据**
>
> 控制器发命令给运算器，进行运算(转换控制信号)，**返回结果/状态，可存放进存储器**
>
> 输出设备O将结果过输出到外部存储介质

#### 执行指令主要步骤

🍊 计算机执行一条**指令主要步骤**

![](/static/2020-06-12-00-23-24.png)

* 取指 - Fetch
  * _控制器_将请求的指令地址送往_存储器_
    1. 控制电路,发出控制信号, PC-内部总线->MAR, MAR-地址总线，传递地址
    2. 同时, 控制电路, 发出控制信号, 确定**读操作**
    3. 存储器MAR-地址总线，接收地址
    4. 存储器控制逻辑-控制总线，接收控制总线数据，确定**读操作**
    5. 存储器, <font color="red">地址译码MAR内容, 选中对应存储单元</font>
    6. 将存储单元内容，传至存储器MDR & 控制逻辑-控制总线，反馈CPU完成操作
    7. CPU-MDR-数据总线，接收数据
    8. MDR指令存储IR & 更新PC地址
  * _存储器_按给定地址读出指令，送回_控制器_
* 译码 - Decode
  * 控制器分析指令的操作性质
    1. 指令译码分析IR, <font color="blue">根据指令编码确认实质操作</font>
  * 控制器向有关部件发出指令所需控制信号
    1. <font color="blue">控制电路产生对应控制信号，传至相关部件</font>
* 执行 - Execute
  * 控制器**从通用寄存器or存储器中取出操作数**
  * 控制器**命令运算器**对操作数**进行指令规定的运算**
* 回写 - Write-back
  * 将运算结果**写入通用寄存器or存储器**
    * 如，将ALU-Z输出端结果,<font color="blue">根据控制电路产生的控制信号</font>，传送到R0中

🍬 以上步骤结束后，CPU继续执行下条指令

* 先更新PC内容至MAR, MAR内容再传送至地址总线上...

---

🍊 执行指令的示例 RRR

![](/static/2020-06-14-18-52-39.png)

## 模型机: 计算机结构简化模型

🍊 模型机包含 CPU(控制器&运算器) & 存储器

![](/static/2020-06-12-15-37-20.png)

> 中间通过**系统总线**连接
>
> * 控制总线 - 控制逻辑
> * 地址总线 - MAR
> * 数据总线 - MDR

### 模型机存储器

> 设计初期，确定存储器的编址方式(决定存储单元大小,位宽)

![](/static/2020-06-13-21-57-14.png)

* 如果**按字节编址**，则**每个存储单元位宽(存放)8bit**
* **地址总线 - MAR存储器地址寄存器**
  * <font color="blue">CPU访问存储单元</font>通过<font color="purple">地址总线</font>，给出**存储单元地址**,存储在**MAR**中
  * 地址总线宽度(位宽)为`n`, 则CPU能选中<font color="red">最多</font>`2^n`个存储单元
* **数据总线 - MDR存储器数据寄存器**
  * <font color="blue">CPU读写数据</font>通过<font color="purple">数据总线</font>，存储在**MDR**中
  * <font color="red"><b>数据总线宽度</b>一般为存储单元位宽的整数倍</font>
* **控制总线 - 控制逻辑**
  * 接收来自CPU的读写信号
  * 向CPU反馈传输完成的信号

### 模型机CPU: 控制器

![](/static/2020-06-13-22-08-57.png)

> 用于控制计算机各部件，完成
>
> * **取指**
> * **分析(译码)**
> * **执行**
>
> 等功能

---

🍊 控制器的组成

![](/static/2020-06-13-22-08-57.png)

* IR - 指令寄存器
  * 存放<font color="blue">正在执行/即将执行的指令</font>(从存储器中读取)
* PC - 程序计数器
  * 存放<font color="blue">下条指令的存储单元地址</font>
  * <font color="purple">具有自动增量计数功能</font>,**取完下条指令后，PC需要自动递增以指向后来指令地址**
* MAR - 存储器地址寄存器
  * 访存时，存放存储单元地址
  * <font color="blue">有简单的电路识别</font>
* MDR - 存储器数据寄存器
  * 访存时，存放读写数据
* **指令译码 & 控制电路**
  * 指令译码 - <font color="blue">对IR中指令进行译码，以确定存放的是哪条指令</font>
  * 控制电路 - <font color="red">确定指令后</font>，产生对应<font color="blue"><b>控制信号</b>，持续脉冲同步下控制CPU各个控制部件</font>

### 模型机CPU: 运算器

![](/static/2020-06-13-22-45-30.png)

> 用于**算术** & **逻辑**运算

---

🍊 运算器基本组成

![](/static/2020-06-14-00-46-52.png)

* **ALU - 算术逻辑单元**
  * input `x`,`y` (数据暂存,register file通用寄存器)
  * output `z` (数据暂存，register file通用寄存器)
  * carry `f` - <font color="blue">运算结果状态(0/正负/进位/溢出)</font>

🍬 通用寄存器 register file

* 用于临时存放**存储器** or **ALU** or **其他通用寄存器**的数据
* R0~Rn-1

🍬 通用寄存器之间 或与 ALU，<font color="purple">传递数据要经过CPU<b>内部总线</b></font>

![](/static/2020-06-14-18-18-36.png)

## 计算机的I/O

🍙 根据冯诺依曼的要求，计算机的程序需要<font color="red">通过输入设备传送至存储器中</font>

![](/static/2020-06-16-23-08-59.png)
![](/static/2020-06-18-21-18-37.png)

* 需要<font color="blue">外部记录介质R</font>, 作为输入输出源
  * 特性: 断电不易失

---

🍬 第一台**微型**计算机: Altair 8800

![](/static/2020-06-18-21-30-02.png)
![](/static/2020-06-18-21-30-33.png)

---

🍊 连接简单I/O设备

![](/static/2020-06-18-22-38-03.png)

* I/O芯片有两个独立地址的单元
  * 其中一个单元连接手动开关(8 bit每个对应1个开关)，通过开关控制电频
  * 另一个单元连接8个小灯泡, 1 - 灯泡亮， 0 - 灯泡灭

---

🍬 “输入”场景

![](/static/2020-06-19-10-16-12.png)

> 假设需要读取8个手动开关的bit状态
>
> 1. 控制电路,发出控制信号, **PC-内部总线->MAR, MAR-地址总线，传递地址**
> 2. MAR地址->地址总线(**简单识别回路,辨别该地址应被发送至哪个部件**)->I/O设备MAR
> 3. 同时,控制电路,控制信号->控制总线(**读操作**)->I/O设备控制逻辑
> 4. 通过I/O**控制逻辑&地址译码器**，**选中**对应MAR地址的**单元**
> 5. 数据->MDR,同时控制信号，**反馈CPU完成**，MDR->数据总线->CPUMDR

🍬 “输入”场景

![](/static/2020-06-19-10-23-59.png)

> 1. 控制电路,发出控制信号, **PC-内部总线->MAR, MAR-地址总线，传递地址**
> 2. MAR地址->地址总线(**简单识别回路,辨别该地址应被发送至哪个部件**)->I/O设备MAR
> 3. 同时,控制电路,控制信号->控制总线(**写操作**)->I/O设备控制逻辑
> 4. MDR->数据总线->I/O-MDR
> 5. 通过I/O**控制逻辑&地址译码器**，**选中**对应MAR地址的**单元**，写入
> 6. 反馈CPU完成信号

### 现代PC的输入输出

![](/static/2020-06-19-10-33-59.png)

🍙 早期PC，<font color="blue">每个设备都需要通过对应的I/O芯片或者板卡（声卡, 网卡, 显卡）进行连接</font>

🍙 现代PC中，大多I/O控制芯片都会集中在主板的<font color="purple">南桥芯片</font>中

🍙 高性能显示等要求，**仍需要独立板卡or芯片与该设备相连**

## 冯诺依曼结构原理&实现的对应

![](/static/2020-06-20-15-06-58.png)

🍙 <font color="blue">不要纠结南北桥结构对应的到底是什么，结构不断变化，参考后续章节(南北桥架构演变)</font>

* CPU访问主存需要通过<font color="blue">北桥芯片(低性能情况下，)</font>，<font color="red" style="text-decoration:underline">为解决性能问题，主存控制器移至CPU芯片中，不再需要通过北桥芯片访问主存</font>
  * 计算机刚加电时主存无信息
* <font color="blue">南桥芯片</font>, 集成了多个I/O设备的控制芯片，其中包括**硬盘-外部记录介质(外存)**
  * <font color="blue">对硬盘进行配置&访问</font>，本身需要通过<font color="purple">硬盘驱动程序(bios自举启动)</font>控制

### BIOS-ROM芯片

🍬 计算机刚加电时，CPU<font color="blue">无法直接从硬盘获取<b>第一条指令</b></font> -【<font style="text-decoration: underline">需要依次经过，北，南桥访问到BIOS芯片，再读取第一条指令</font>】

* 存储在主板的<font color="blue">BIOS-ROM芯片(FLASH-NORROM)</font>中，<font color="green">BIOS芯片与南桥相连</font>
  * 保存bios程序，用于检测设备&设备状态(自检自举，中断等)
  * 如POST检查**显卡**，点亮显示器。

### 扩展: 显卡 & 南北桥架构的演变

🍙 现在显卡功能越来越复杂

* 尤其是图形处理单元 - GPU
  * 支持很多复杂数学运算，所以有时候（高性能超级计算机）也会让<font color="blue">GPU承担运算工作</font>
  * 即，某种意义上，GPU承担运算器&控制器的功能

🍙 独立显卡 & 集成显卡

* **独立显存集成显卡**就是在主板上有独立的显存芯片，不需要系统内存，独立运作；
* **内存划分集成显卡**，顾名思义，从主机系统**内存当中划分出来的一部分内存作为显存**供集成显卡调用，
  * 这也就是常常看到的集成显卡的机器为什么显示的系统内存和标称不符
* **混合式集成显卡**就是既有主板上的**独立显存又有从内存中划分的显存**同时使用，如AMD的780G芯片组

---

1. 最初南北桥架构(低性能, CPU-北-南)，传统<font color="red">三片式</font>

   ![](/static/2020-06-20-16-40-03.png)

   * CPU - 通常多核
   * CPU连接<font color="red">北桥</font>，有:
     * <font color="blue"><b>主存控制器 - 连接主存</b></font>
     * <font color="blue">PCI-E控制器(显卡大多为PCI-E接口) - 通过PCI-E插槽连接显卡</font>. <font style="text-decoration:underline">如果对显示性能要求不高，也可以通过北桥内部集成显卡，直接连接显示器</font>
   * 北桥 - 南桥
     * 通过该通道，<font color="red">外部I/O设备可以访问主存</font>

  🍬 各芯片组chipset运输压力大 & 性能低
2. 第一个演变 - <font color="blue">解决访问主存性能问题</font>

  ![](/static/2020-06-22-13-20-16.png)

   * 北桥-主存控制器 移至-> CPU芯片

3. 最新两片式设计 - <font color="red">进一步提升性能，CPU集成PCIE控制器&主存控制器，南北桥整合</font>

  ![](/static/2020-06-22-13-43-12.png)

   * <font color="blue">南北桥功能合并 - I/O控制中心(←各厂家命名不同，如intel称为)</font>

#### 系统芯片

🍊 Sytem on a Chip - SoC

![](/static/2020-06-22-13-47-20.png)

> 进一步缩减,**将计算机/电子系统集成到单一芯片上**

* 该单个芯片集成了冯诺依曼结构所有组件，主板精简，功能健全
* 广泛应用于移动设备中，smart phone, laptop, .etc

#### 扩展: 北桥

🍬 北桥

> 提供了各个芯片之间互相访问的通道.

### Moore's Law

🍊 **摩尔定律**

![](/static/2020-06-20-16-13-27.png)

> 当价格不变时，集成电路上可容纳的元器件的数目，约每隔18-24个月便会增加一倍，性能也将提升一倍（基于摩尔定律）。换言之，**每一美元所能买到的电脑性能，将每隔18-24个月翻一倍以上。这一定律揭示了信息技术进步的速度**

* 集成电路迅速发展
* 摩尔定律，预测的是<font color="blue">集成电路的复杂度</font>

🍬 现多提及摩尔定律是否已走到尽头

* 但摩尔定律所展示的集成电路迅速发展，的却是计算机性能快速提升的关键动力

🍙 摩尔定律的其他描述

* 每18个月，计算机产品的性能会翻一番
* 相同性能的计算机产品，每18个月价格降一半

#### 计算机性能的增长

![](/static/2020-06-20-16-24-13.png)
![](/static/2020-06-20-16-25-30.png)

* 天河2号: 世界最快的超级计算机
* 恰好18个月翻一番，但不严谨

#### 微处理器晶体管数的增长情况

![](/static/2020-06-20-16-32-30.png)

> 微处理器芯片，晶体管数量的增长情况

* <font color="red">晶体管数量的增长速度才是摩尔最初预测的内容</font>