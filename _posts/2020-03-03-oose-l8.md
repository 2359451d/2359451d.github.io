---
layout: post
title: OOSE LECTURE 8 - è®¾è®¡æ¨¡å¼ - è®¿é—®è€…
date: 2020-03-02
excerpt: "è½¯å·¥ - è®¾è®¡æ¨¡å¼, Visitor Design Pattern"
tags: [è¯¾é¢˜, code, è½¯ä»¶å·¥ç¨‹, 2020, oose, è®¾è®¡æ¨¡å¼]
feature: https://previews.123rf.com/images/karpenkoilia/karpenkoilia1709/karpenkoilia170900117/86423976-modern-line-web-concept-for-programming-linear-web-banner-for-coding-.jpg
comments: true
---

* ç›®å½•
{:toc}

TODO: æœªæ‰©å±•

ğŸŠ Learning Outcomes
![](/static/2020-03-03-07-18-45.png)
- åˆ†è¾¨å•æ¬¡åˆ†æ´¾&åŒåˆ†æ´¾
- è®¿é—®è€…æ¨¡å¼ç»“æ„
- ç»„åˆè®¾è®¡æ¨¡å¼è¡ç”Ÿ: è®¿é—®è€…æ¨¡å¼
- ä¼˜ç‚¹ç¼ºç‚¹

## RECAP: Dealing with Structures and Hierachies

![](/static/2020-03-03-07-56-04.png)
- éœ€è¦å¤„ç†åŸºæœ¬&ç»„åˆæ„ä»¶çš„æ ‘çŠ¶å±‚æ¬¡ç»“æ„
  - ä¸é€šè¿‡é¢å¤–åˆ¤æ–­ç±»å‹è€Œå®ç°ç‰¹å®šè¡Œä¸ºè¡¨ç°

![](/static/2020-03-03-07-57-25.png)
- Leaf & Compositeå¯¹è±¡å®ç°å…±åŒæ¥å£ï¼Œå®¢æˆ·ç«¯æ“ä½œç»Ÿä¸€åŒ–

ğŸ¬ (æ•´ä½“-å±€éƒ¨)å±‚çº§ç»„åˆç»“æ„ä¸­éœ€è¦å¼•å…¥æŠ½è±¡ç±»/æ¥å£ã€‚æœ€åè¯¥æŠ½è±¡ç±»å‹ä¼šè¢«å®ç°ä¸ºç‰¹å®šç±»å‹ã€‚

### Single-dispatch

![](/static/2020-03-03-08-19-08.png)
- è¯¥æŠ½è±¡å­—æ®µ AbstractFile(ç¼–è¯‘æ—¶æœŸ)å¯è§£æä¸ºä»»æ„å®ä½“ç±»å‹(è¿è¡Œæ—¶æœŸ)

![](/static/2020-03-03-08-27-01.png)
- è¿è¡Œæ—¶æœŸï¼Œç¨‹åºåŠ¨æ€åˆ†æ´¾å¯¹è±¡å¯¹è±¡åº•å±‚ç±»å‹ï¼Œè°ƒç”¨ls()æ–¹æ³•ã€ç‰¹å®šè¡Œä¸ºã€‘

ğŸŠ æœ€åè¡Œä¸ºå–å†³äº è°ƒç”¨çš„æ–¹æ³• & è°ƒç”¨è€…çš„å®é™…ç±»å‹ã€‚

ğŸŠ å®ç°ç»„åˆè®¾è®¡æ¨¡å¼æ—¶ï¼Œéµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™
![](/static/2020-03-03-08-43-37.png)
![](/static/2020-03-03-08-43-25.png)

## Context

![](/static/2020-03-03-11-37-53.png)
- å‡è®¾æ“ä½œäºä¸åŒç»„åˆ**ç±»å‹**çš„å¯¹è±¡
- åŸºäºç»„åˆè®¾è®¡æ¨¡å¼

### Example: File System

![](/static/2020-03-03-11-45-16.png)
- å‡è®¾Clientå¯¹è±¡å¯ä»¥å¯¹fså¯¹è±¡è¿›è¡Œä»»æ„ä¸åŒæ“ä½œ
  - åŸºäºç»„åˆè®¾è®¡æ¨¡å¼: ä¸ºå…±åŒæŠ½è±¡æ¥å£å®šä¹‰å¤šä¸ªæ“ä½œï¼Œå¹¶åœ¨å®ä½“ç±»ä¸­å®ç° -> é€ æˆä»£ç å†—ä½™,å†…èšæ€§ä½ï¼Œå¼•å…¥è®¿é—®è€…æ¨¡å¼

![](/static/2020-03-03-11-54-45.png)

## Visitors Design Pattern

### Intent

![](/static/2020-03-03-11-58-33.png)
- å°†æ•°æ®ç»“æ„ä¸æ“ä½œåˆ†ç¦»ã€‚å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ (è€¦åˆ)çš„æƒ…å†µä¸‹å®šä¹‰æ–°æ“ä½œ(ç»“æ„å¯¹è±¡çš„å…ƒç´ )ã€‚

### Implementation

ğŸŠ æ­¥éª¤
![](/static/2020-03-03-12-18-18.png)
- å°†æ‰€éœ€æ“ä½œå°è£…è¿›å•ç‹¬å¯¹è±¡ä¸­ã€‚ç§°ä¸ºè®¿é—®è€…ã€‚**ä¸»è¦ç”¨äºè®¿é—®**
  - **è®¿é—®è€…å¯¹è±¡å¯ä»¥éå†æ ‘çŠ¶å±‚æ¬¡ç»“æ„ä¸­æ‰€æœ‰å…ƒç´ **(ç‹¬ç«‹&ç»„åˆç»“ç‚¹)
- å½“æŸæ ‘ç»“ç‚¹"æ¥å—"è®¿é—®è€…å¯¹è±¡æ—¶, ä¼šè°ƒç”¨ä¸€ä¸ªä»¥è¯¥ç»“ç‚¹ä½œä¸ºå‚æ•°çš„Visitoræ–¹æ³•
  - æœ‰æ–°çš„æ“ä½œæ·»åŠ æ—¶,å®šä¹‰ä¸åŒè®¿é—®è€…å­ç±»

ğŸ¬ è®¿é—®è€…
![](/static/2020-03-03-12-22-23.png)
- å®šä¹‰ ComponentVsitor åŸºç±»
- ComponentåŸºç±»å®šä¹‰accept(Visitor v)
- è®¿é—®è€…å®ç°ç±»å¯ä¸ºLeafç»“ç‚¹ï¼ŒCompositeç»“ç‚¹

### Visitor Example: File System

ğŸ¬ åˆ©ç”¨è®¿é—®è€…æ¨¡å¼å®ç°è¯¥ä¾‹å­

ğŸŠ AbstractFileVisitoræŠ½è±¡æ¥å£: è®¿é—®ç»“æ„ä¸­å„å…ƒç´ çš„åŸºæœ¬æ“ä½œ

```java
public interface AbstractFileVisitor {
	public void visit(BinaryFile bf);
	
	public void visit(Folder f);
	
	public void visit(Shortcut s);
	
	public void visit(TextFile tf);
}
```

ğŸŠ AbstractFileç»“ç‚¹åŸºç±»: æ·»åŠ accept(AbstractFileVisitor afv)æ“ä½œ

```java
public abstract class AbstractFile {
	String name;

	public abstract void ls();
	public abstract String getType();	
	public void add(AbstractFile f) {}
	public abstract void accept(AbstractFileVisitor afv);
}
```

ğŸŠ Leafå®ç°ç±»: å®ç°accept()â€œæ¥å—â€è®¿é—®è€…
- BinaryFile & TextFile(TYPE="txt")

```java
public class BinaryFile extends AbstractFile{
	public static final String TYPE = ".exe";
	
	public BinaryFile(String name){
	      this.name = name; 
    }
	
	@Override
	public String getType() {
		return TYPE;
	}
	
	@Override
	public void ls() {
	   System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
	}

	@Override
	public void accept(AbstractFileVisitor afv) {
		afv.visit(this);
		
	}
}
```

- Shortcut

```java
public class Shortcut extends AbstractFile{
	//models a link (shortcut) to an Entry not in the present folder/level
public AbstractFile link;

public static final String TYPE = ".shortcut";


	public Shortcut(String name, AbstractFile link) {
		this.name = name;
		this.link = link;
	}
	
	@Override
	public String getType() {
		return TYPE;
	}
	
	@Override
	public void ls() {
		System.out.println(CompositeDemo.compositeBuilder + name+link.getType()+TYPE);
	}
	
	@Override
	public void accept(AbstractFileVisitor afv) {
		afv.visit(this);	
	}
}
```

- Folder

```java
public class Folder extends AbstractFile{
	public static final String TYPE = "/";

    private ArrayList<AbstractFile> includedFiles = new ArrayList<AbstractFile>();

	public Folder(String name) {
		this.name = name;  
		includedFiles = new ArrayList<AbstractFile>();  
	}

	public AbstractFile find(String name) {
		AbstractFile ans = null;
		for(AbstractFile af:includedFiles) {
			if(af.name.equals(name)) {
				ans = af;
				break;
			}
		}
		return ans;
	}

	public void add(AbstractFile e) { 		
		if(!includedFiles.contains(e)) {
			includedFiles.add(e);
		}
	}
	
	public ArrayList<AbstractFile> getIncludedFiles() { 		
		return includedFiles;
		
	}


	@Override
	 public void ls() {
	        System.out.println(CompositeDemo.compositeBuilder + name+TYPE);
	        CompositeDemo.compositeBuilder.append("   ");
	        for (AbstractFile as : includedFiles) {
	        		as.ls();
	        }
	        CompositeDemo.compositeBuilder.setLength(CompositeDemo.compositeBuilder.length() - 3);
	    }

	@Override
	public String getType() {
		return TYPE;
	}
	
	@Override
	public void accept(AbstractFileVisitor afv) {
		afv.visit(this);	
		includedFiles.forEach(af ->{
			af.accept(afv);
		});		
	}

}
```

ğŸ¬ è§£å†³äº†æ ¸å¿ƒé—®é¢˜: å¼•å…¥æ–°æ“ä½œæ—¶ä¸å†éœ€è¦æ”¹å˜å¤šä¸ªç»“ç‚¹æºç ï¼Œæé«˜ä¸šåŠ¡å†…èšæ€§

![](/static/2020-03-03-12-46-48.png)
- æ‰€æœ‰èŠ‚ç‚¹å®ç°accept()æ“ä½œï¼Œè¯­ä¹‰ä¸Šç›¸åŒ
- accept()æ“ä½œç”¨äºæ¥å—å‚æ•°(ç‰¹å®šè®¿é—®è€…å¯¹è±¡çš„**æŒ‡é’ˆ/å¼•ç”¨**)
  - æœ€åå®é™…æ˜¯è°ƒç”¨è¯¥ç‰¹å®šè®¿é—®è€…æ“ä½œ, å¹¶å°†è¯¥ç»“ç‚¹è‡ªèº«ä½œä¸ºå‚æ•°

ğŸŠ AbstractFileVisitor

```java
public class FindVisitor implements AbstractFileVisitor{
	private String matchstring;
	public ArrayList<AbstractFile> result;
	public FindVisitor(String matchstring) {
		this.matchstring  = matchstring;
		result = new ArrayList<AbstractFile>();
	}
	@Override
	public void visit(BinaryFile bf) {
		if(bf.name.contains(matchstring))
			result.add(bf);
	}
	@Override
	public void visit(TextFile tf) {
		if(tf.name.contains(matchstring))
			result.add(tf);
	}
	@Override
	public void visit(Folder f) {
//		f.getIncludedFiles().forEach(af ->{
//			af.accept(this);
//		});
	}
	@Override
	public void visit(Shortcut s) {}
}
```

ğŸŠ Client: ç”¨äºé€šè¿‡è®¿é—®è€…å¯¹æ ‘çŠ¶å±‚æ¬¡ç»“æ„ç»“ç‚¹è¿›è¡Œæ“ä½œ
![](/static/2020-03-03-13-11-27.png)
- åˆ›å»ºConcreteVisitorå¯¹è±¡
- è®¿é—®è€…éå†æ ‘ç»“æ„ä¸­å„ç»“ç‚¹

---

ğŸ¬ ä¸»ç¨‹åº
![](/static/2020-03-03-13-16-33.png)
- ç»„åˆå¯¹è±¡ï¼Œå®¢æˆ·ç«¯ï¼Œè®¿é—®è€…è´Ÿè´£éå†ç»“æ„ä¸­å…ƒç´ èŠ‚ç‚¹

å¥—å¨ƒ: 
- Folder(ç»„åˆå¯¹è±¡)éå†å­å…ƒç´ ã€‚(åªé’ˆå¯¹æ‰€æœ‰è®¿é—®è€…ç»Ÿä¸€é¡ºåºè®¿é—®å…ƒç´ çš„æƒ…å†µ)
![](/static/2020-03-03-13-28-18.png)
- Client(å¤–éƒ¨å¯¹è±¡)éå†å„ç»“ç‚¹
![](/static/2020-03-03-13-30-16.png)
- Clientéœ€è¦çŸ¥é“å†…éƒ¨æ•°æ®ç»“æ„
- visitorä¸ºæ³›å‹

FSç±»å›¾
![](/static/2020-03-03-13-55-57.png)

---

### Structure of Visitors Design Pattern

![](/static/2020-03-03-13-56-47.png)

## Double Dispatch

ğŸ¬ åŒå‘åˆ†æ´¾
![](/static/2020-03-03-13-57-37.png)
- å‡è®¾å°†Visitorå¯¹è±¡ä½œä¸ºæŒ‡é’ˆä¼ å…¥Componentç»“ç‚¹çš„accept()æ–¹æ³•ä¸­
  - æœ€ç»ˆï¼Œ**é€šè¿‡Client**åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šè°ƒç”¨accept()

<font color="red">æœ€ç»ˆè¡Œä¸ºå–å†³äº: ç»“ç‚¹ç±»å‹Component & è®¿é—®è€…ç±»å‹ Visitor</font>

> æ¥æ”¶accept()æ“ä½œå°±æ˜¯ä¸€ä¸ªåŒåˆ†æ´¾çš„æ“ä½œï¼Œæ‰§è¡Œçš„æ“ä½œä¸ä»…å–å†³äºè®¿é—®è€…ç±»å‹(çŠ¶æ€)ï¼Œè¿˜å–å†³äºå®ƒè®¿é—®çš„å…ƒç´ ç±»å‹

ğŸ¬ å› ä¸ºä¸€èˆ¬è¦å¯¹æ¯”è®¿é—®ä¸åŒå…ƒç´ ç»„ä»¶ï¼Œæ‰€ä»¥å¯¹è±¡ç»“æ„**éœ€è¦åˆ—è¡¨å­˜æ”¾ä¸åŒç»„ä»¶**ï¼Œå†å¯¹è¿™äº›ç»„ä»¶è¿›è¡Œéå†å¯¹æ¯”è®¿é—®ã€‚

ğŸ¬ å®¢æˆ·ç«¯ä¸­ï¼Œç”Ÿæˆä¸åŒç»„ä»¶ï¼Œæ”¾è¿›å¯¹è±¡ç»“æ„çš„åˆ—è¡¨ä¸­ï¼Œå¯¹å¤–è°ƒç”¨display()ï¼Œå¯¹è±¡ç»“æ„ä¸­å†…éƒ¨éå†è®¿é—®

---

### Advantages & Disadvantages (Consequences)

![](/static/2020-03-03-14-09-15.png)
ğŸŠ ä¼˜ç‚¹
- (å¼•å…¥æ–°æ“ä½œæ—¶)ï¼Œæ ‘çŠ¶å±‚æ¬¡ç»“æ„ä¿æŒä¸å˜ï¼Œæ— å†—ä½™ä»£ç 
- å°†ä¸šåŠ¡åŠŸèƒ½å°è£…è¿›Visitorå¯¹è±¡(å®ç°æ•°æ®ä¸ä¸šåŠ¡çš„åˆ†ç¦»ï¼Œæé«˜å†…èšæ€§)

ğŸŠ ç¼ºç‚¹
- æ–°çš„èŠ‚ç‚¹å…ƒç´ å¯èƒ½éœ€è¦æ”¹å˜VisitoråŸºç±»/æ¥å£
- Visitor & Componentä¹‹é—´çš„å¾ªç¯ä¾èµ–

### Applicability

ğŸ¬ åº”ç”¨åœºæ™¯
![](/static/2020-03-03-14-12-20.png)
- å½“æŸ(æŠ½è±¡)ç±»ä¸­å­˜åœ¨è¿‡å¤šä¸ç›¸å…³æ“ä½œï¼Œä¸šåŠ¡ä¸é›†ä¸­(å†…èšæ€§ä½)
- ç±»å¯¹è±¡é—´æ•°æ®ç»“æ„å…³ç³»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦æ”¹å˜æ“ä½œ(å¼•å…¥æ“ä½œï¼Œè¦†å†™ç°æœ‰æ“ä½œ)

<font color="red">

- æœ‰æ¯”è¾ƒç¨³å®šçš„æ•°æ®ç»“æ„ï¼Œä¸”æœ‰ç»å¸¸å˜åŒ–çš„ç®—æ³•ã€‚å› ä¸ºä½¿ç”¨è®¿é—®è€…æ¨¡å¼ä½¿å¾—ç®—æ³•æ“ä½œçš„å¢åŠ å˜å¾—å®¹æ˜“ã€‚

- è®¿é—®è€…çš„ä¼˜ç‚¹ï¼šå¢åŠ æ–°çš„æ“ä½œå¾ˆç®€å•ï¼Œ**å¢åŠ æ–°çš„æ“ä½œå³å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€…ã€‚**ã€‚è®¿é—®è€…æ¨¡å¼å°†æœ‰å…³è¡Œä¸ºé›†ä¸­åˆ°ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä¸­ã€‚

</font>

ğŸ™ å¤§å¤šæ•°æ—¶é—´ä¸éœ€è¦ç”¨åˆ°è®¿é—®è€…æ¨¡å¼ï¼Œ**å› ä¸ºå¾ˆéš¾æ‰¾åˆ°æ•°æ®ç»“æ„ä¸å˜åŒ–çš„æƒ…å†µã€‚**