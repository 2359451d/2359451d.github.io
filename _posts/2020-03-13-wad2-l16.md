---
layout: post
title: "WAD2 LECTURE 16 - AJAX"
date: 2020-03-13
excerpt: "webç¬”è®°, AJAX"
tags: [å­¦ä¹ ç¬”è®°, WAD, 2020, web]
feature: https://www.pngkey.com/png/detail/212-2125619_web-development-creative-web-design-banner.png
comments: true
---

* ç›®å½•
{:toc}

å‚è€ƒ - [AJAXæ‰©å±•](http://www.barlinbento.top/web2-ajax/#%E5%AE%89%E5%85%A8%E9%99%90%E5%88%B6%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5-open%E5%87%BD%E6%95%B0url%E5%8F%82%E6%95%B0)

## AJAX origins

![](/static/2020-03-30-01-38-54.png)

* å¼‚æ­¥JS & XML

### Objectives

![](/static/2020-03-30-01-40-29.png)

* æ— éœ€åŒæ­¥æœºåˆ¶(å¼‚æ­¥)
* æ— éœ€ç­‰å¾…æ•°æ®å®Œå…¨åŠ è½½è¿”å›
* AJAX Engine - ä¸­é—´ä»¶: å¤„ç†å®¢æˆ·ç«¯&æœåŠ¡å™¨äº¤äº’
* æ”¹è¿›äº¤äº’æ€§

### Technology Set

![](/static/2020-03-30-01-45-56.png)

* XHTML & CSS è¡¨ç¤º
* åŠ¨æ€äº¤äº’DOM
* XML & XSLT æ•°æ®æ“ä½œ&æ”¹å˜
* åŸºäºXMLHttpRequestçš„å¼‚æ­¥æ•°æ®æ£€ç´¢
* js

## Traditional Mechinism Overview

ğŸŠ ä¼ ç»ŸåŒæ­¥æœºåˆ¶: éœ€è¦ç­‰å¾…æ•°æ®å®Œå…¨è¿”å›
![](/static/2020-03-30-01-48-15.png)

## AJAX Components

![](/static/2020-03-30-01-53-02.png)

* ä½¿ç”¨jsæ“ä½œ**dom** - æ¸²æŸ“æ•°æ®
* **jsäº‹ä»¶**å¤„ç†æœºåˆ¶ - ç”¨æˆ·(å®¢æˆ·ç«¯)äº‹ä»¶
* **XML/JSON**ä¼ è¾“æ•°æ® - ä½¿ç”¨DOMè®¿é—®

### XMLHttpRequest Object

![](/static/2020-03-30-01-57-43.png)
![](/static/2020-03-30-02-02-52.png)

ğŸŠ XHRå¯¹è±¡ï¼ŒåŸºäºDOMæ“ä½œ

* é€šè¿‡å‘é€XHRå¯¹è±¡è¯·æ±‚ä¸æœåŠ¡å™¨é€šä¿¡(client - server)
* ç‹¬ç«‹äº form, aæ ‡ç­¾
  * **å¯äº§ç”Ÿ HTTP GET/POST ç±»å‹è¯·æ±‚**
* <font color='red'>å‘é€è¯·æ±‚åï¼Œä¸ä¼šé”å®šçª—å£å…¶ä»–æ‰§è¡Œ</font>
* jså¯å¯¹äºHTTPé€šä¿¡åˆ†åˆ«æ“ä½œ æ•°æ®ï¼Œæ ·å¼éƒ¨åˆ†

### Asynchronous Mechanism

![](/static/2020-03-30-02-06-36.png)

### Asynchronous vs Synchronous

![](/static/2020-03-30-02-07-39.png)

## AJAX Workflow

![](/static/2020-03-30-02-10-46.png)

1. jsäº‹ä»¶å¯¹è±¡è§¦å‘
2. jsç”Ÿæˆ`XMLHttpRequest`å¯¹è±¡
3. å‘é€`XMLHttpRequest`å¯¹è±¡è‡³æœåŠ¡å™¨
4. æœåŠ¡å™¨å¤„ç†è¯¥è¯·æ±‚ï¼ˆå¼‚æ­¥ï¼‰
5. **æœåŠ¡å™¨å‘é€å“åº”**
6. **ç”±jsä¸­çš„å›è°ƒå‡½æ•°æ¥æ”¶è¯¥å“åº”**
7. è¿›è¡ŒDOMæˆ–ç›¸åº”æ“ä½œ (æ ¹æ®å“åº”æ•°æ®)

### XHR Properties

ğŸŠ å›è°ƒå‡½æ•° - XHRå¯¹è±¡å±æ€§(åˆ¤æ–­&æ¸²æŸ“å“åº”ä¸­ç‰¹å®šæ•°æ®)
![](/static/2020-03-30-02-30-26.png)
![](/static/2020-03-30-02-30-17.png)

* `readyState`å±æ€§(**åˆ¤æ–­XHRå¯¹è±¡çŠ¶æ€**)
  * `0`: è¯·æ±‚æœªåˆå§‹åŒ–
  * `1`: å»ºç«‹æœåŠ¡å™¨è¿æ¥
  * `2`: è¯·æ±‚æ¥æ”¶
  * `3`: è¯·æ±‚å¤„ç†
  * `4`: è¯·æ±‚å¤„ç†å®Œæˆï¼Œå‡†å¤‡**å“åº”**

* `onreadystatechange`å±æ€§
  * æ¥æ”¶äº‹ä»¶ç›‘å¬å™¨å€¼ï¼ŒæŒ‡å®š`readyState`å±æ€§æ”¹å˜æ—¶çš„**è°ƒç”¨å‡½æ•°**

* `status`å±æ€§ - HTTPçŠ¶æ€ç 
  * 200 = OK
  * 404 = Not Found

* `responseXML`XHRå¯¹è±¡**å“åº”å±æ€§**
  * <font color="red">è§£æå“åº”ä¸ºXMLæ•°æ®ç±»å‹ - read only</font>
  * å½“å®Œæ•´HTTPå“åº”è¢«æ¥æ”¶(**å®¢æˆ·ç«¯,å›è°ƒå‡½æ•°readyState=4**)&
  * å½“è¡¨å¤´æŒ‡å®šMIMEç±»å‹ = `text/xml`,`application/xml`,`+xml`æ—¶

* `responseText`XHRå¯¹è±¡**å“åº”å±æ€§**
  * åŒ…å«å“åº”ä¸­çš„**æ–‡æœ¬æ•°æ®**ï¼Œå¦‚**json**ç­‰æ•°æ®æ ¼å¼

---

![](/static/2020-03-30-02-26-19.png)

#### responseXML

![](/static/2020-03-30-02-41-12.png)

![](/static/2020-03-30-02-40-38.png)

#### resonseText(JSON)

![](/static/2020-03-30-02-43-58.png)

![](/static/2020-03-30-02-44-46.png)

### XHR Methods

ğŸŠ XHRå¯¹è±¡æ–¹æ³•

![](/static/2020-03-30-02-50-39.png)
![](/static/2020-03-30-03-18-03.png)

* `open(method,url,async,user,psw)`æŒ‡å®šè¯·æ±‚ä¸­:
  * method - è¯·æ±‚ç±»å‹: GET/POST
  * url - è¯·æ±‚è·¯ç”±ä½ç½®
  * async - true:å¼‚æ­¥/false:åŒæ­¥
  * user - å¯é€‰ç”¨æˆ·å
  * psw - å¯é€‰å¯†ç 

* `send()`
  * å‘é€XHRå¯¹è±¡è¯·æ±‚
  * **æ— å‚å‡½æ•°**ç”¨äº`GET`XHRè¯·æ±‚

* `send(string)`
  * å‘é€XHRå¯¹è±¡è¯·æ±‚è‡³æœåŠ¡å™¨
  * æœ‰å‚å‡½æ•°ï¼Œç”¨äº`POST`è¯·æ±‚

* `abort()`
  * å–æ¶ˆå½“å‰è¯·æ±‚

* `setRequestHeader()`
  * è¯·æ±‚å¯¹è±¡çš„å¤´éƒ¨æ–‡æ¡£æ·»åŠ é”®å€¼å¯¹
  * å¯ç»“åˆPOSTæ•°æ®ä½¿ç”¨ï¼ŒæŒ‡å®š`send()`æ–¹æ³•çš„æ•°æ®ç±»å‹

* `getAllResponseHeaders()`
  * è¿”å›**æ‰€æœ‰**å“åº”å¤´éƒ¨ä¿¡æ¯ï¼Œå¦‚é•¿åº¦ï¼ŒæœåŠ¡ç±»å‹ï¼Œå†…å®¹ç±»å‹ï¼Œæœ€åä¿®æ”¹

* `getResposneHeader()`
  * è¿”å›**ç‰¹å®šå“åº”å¤´(æœ€åä¿®æ”¹)**

## AJAX Example

### HTML Header

![](/static/2020-03-30-16-26-31.png)
![](/static/2020-03-30-16-27-32.png)

* å¤´éƒ¨jsæ–‡ä»¶ï¼Œæ³¨æ„XHRå¯¹è±¡åˆ›å»º(GETè¯·æ±‚)&å‘é€ï¼Œå›è°ƒå‡½æ•°äº‹ä»¶ç›‘å¬ï¼ŒDOMæ“ä½œ
* htmlä½“ä¸­è®¾ç½®äº‹ä»¶å…ƒç´ 

### Sending a Request

![](/static/2020-03-30-16-30-46.png)

ğŸ¬ é€šè¿‡`Math.random()`å‡½æ•°ç”Ÿæˆéšæœºidï¼Œé¿å…è·å–ç¼“å­˜æ•°æ®

è¯·æ±‚ç±»å‹: GET/POST

* GET - å¿«é€Ÿï¼Œæ•°æ®é‡å°
* POST
  * éç¼“å­˜æ–‡ä»¶
  * å‘æœåŠ¡å™¨åˆ†æ®µä¼ è¾“å¤§é‡æ•°æ®,æ— å¤§å°é™åˆ¶(é€šå¸¸)
  * å‘é€ç”¨æˆ·è¯·æ±‚ï¼Œ**å®‰å…¨æ€§**

---

![](/static/2020-03-30-17-10-45.png)

ğŸ¬ ä½¿ç”¨GETè¯·æ±‚å‘é€æ•°æ®ï¼Œéœ€è¦æŒ‡å®šurlä¸­é”®å€¼å¯¹

### Responses from the server

![](/static/2020-04-05-18-56-53.png)

### Processing XML

![](/static/2020-04-05-18-57-35.png)
![](/static/2020-04-05-18-58-06.png)

* è·å–æ¯ä¸ªcdæ ‡ç­¾çš„titleç»“ç‚¹

### Processing JSON

![](/static/2020-04-05-18-58-58.png)
![](/static/2020-04-05-19-01-46.png)

### Callback Func

å›è°ƒå‡½æ•°

![](/static/2020-04-05-19-02-15.png)

ğŸŠ
ç”¨äºç»™å…¶ä»–å‡½æ•°ä¼ å‚ç”¨

ğŸ¬å¦‚æœå­˜åœ¨å¤šä¸ªajaxå¤„ç†ï¼Œåˆ›å»ºä¸€ä¸ªæ‰§è¡ŒXHRå¯¹è±¡çš„å‡½æ•°ï¼Œä¸ºæ¯ä¸ªå¯¹è±¡åˆ›å»ºå“åº”å›è°ƒå‡½æ•°

ğŸ¬ ä¸»å‡½æ•°åº”åŒ…å«URL & å“åº”readyæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•°

EXAMPLE

![](/static/2020-04-06-14-22-59.png)