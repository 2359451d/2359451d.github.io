---
layout: post
title: WAD2 LECTURE 5
date: 2020-02-17
excerpt: "webç¬”è®°, å†ä¸çœ‹å¿«ç‚¹å°±è¦å—å±äº†"
tags: [å­¦ä¹ ç¬”è®°, code, WAD, 2020, web]
feature: https://www.pngkey.com/png/detail/212-2125619_web-development-creative-web-design-banner.png
comments: true
---

åŸºäºbeginners' tutorial part5 & 6

## ç›®å½•

* ç›®å½•
{:toc}

---

## å¤§çº²

![](/static/2020-02-21-16-14-02.png)
- è‡ªåŠ¨æµ‹è¯•
- pollsç›¸å…³
- æµ‹è¯•è§†å›¾
- CSSç®€ä»‹
- **é™æ€æ–‡ä»¶**

## è‡ªåŠ¨æµ‹è¯• automated tests

![](/static/2020-02-21-16-15-27.png)
- ç”±ç³»ç»Ÿå®Œæˆçš„è‡ªåŠ¨æµ‹è¯•ç”¨ä¾‹
- åˆ›å»ºä¸€ç³»åˆ—æµ‹è¯•ç”¨ä¾‹ç”¨äºå„ä¸ªé˜¶æ®µæµ‹è¯•

### æµ‹è¯•ç›®çš„&é‡è¦æ€§

![](/static/2020-02-21-16-16-43.png)
- çœæ—¶
- åˆ†è¾¨&é¿å…æŸäº›æ½œåœ¨é—®é¢˜
- æå‡ä»£ç è´¨é‡&å›¢é˜Ÿé¡¹ç›®

### åŸºäºæµ‹è¯•çš„å¼€å‘ test-driven development

![](/static/2020-02-21-16-17-56.png)
- test before writing

## Polls app ç›¸å…³

### Bug

![](/static/2020-02-21-16-19-10.png)

ğŸ¬ å‰ç•¥BUG: é’ˆå¯¹``pub_date``å­—æ®µ,å¦‚å°†å€¼è®¾ä¸ºæœªæ¥æŸæ—¶é—´ç‚¹(æœªå‘ç”Ÿ), è¯¥æ–¹æ³•ä»è¿”å›True.

#### Test for checking  

ä¸º test.py æ–‡ä»¶æ·»åŠ 

```python
import datetime
from django.utils import timezone
from django.test import TestCase
from .models import Question
class QuestionMethodTests(TestCase):
    def test_was_published_recently_with_future_question(self):
        # was_published_recently() should return False for
        # questions whose pub_date is in the future
        time = timezone.now() + datetime.timedelta(days=30)
        future_question = Question(pub_date=time)
        self.assertIs(future_question.was_published_recently(),
        False)
```

ğŸ¬ é’ˆå¯¹poll appçš„è¯¥æµ‹è¯•
1. åˆ›å»ºä¸€ä¸ªQuestionå®ä¾‹(pub_dateå­—æ®µä¸ºæœªæ¥30å¤©ä¹‹å)
2. ``assertIs()``æ–¹æ³•ç”¨äºæ£€æµ‹è¯¥å®ä¾‹è¿”å›çš„å¸ƒå°”å€¼
3. è¯¥bugä¼šå¯¼è‡´æµ‹è¯•è¿”å›False,test failed

``python manage.py test polls``æ‰§è¡Œè¯¥æµ‹è¯•ï¼Œè¾“å‡º
![](/static/2020-02-21-16-30-18.png)

- è¯¥æŒ‡ä»¤æŸ¥æ‰¾pollsåº”ç”¨ä¸­æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
- æŸ¥æ‰¾ ç»§æ‰¿``django.test.TestCase``çš„å­ç±»&& å­ç±»ä¸­ä»¥``test_xxx``å¼€å¤´çš„æ–¹æ³•
- åˆ›å»ºæµ‹è¯•ä¸“ç”¨database

#### Fixing the bug

models.py æ–‡ä»¶æ·»åŠ 

```python
def was_published_recently(self):
 now = timezone.now()
 return now - datetime.timedelta(days=1) <=
 self.pub_date <= now 
```

#### å®Œæ•´æµ‹è¯•

```python
def test_was_published_recently_old_question(self):
    # was_published_recently() should return False for
    # questions whose pub_date is older than 1 day.
    time = timezone.now() - datetime.timedelta(days=30)
    old_question = Question(pub_date=time)
    self.assertIs(old_question.was_published_recently(),
    False)
def test_was_published_recently_recent_question(self):
    # was_published_recently() should return True for
    # questions whose pub_date is within the last day.
    time = timezone.now() - datetime.timedelta(hours=1)
    recent_question = Question(pub_date=time)
    self.assertIs(recent_question.
    was_published_recently(), True) 

```

#### æ¨¡æ‹Ÿæµ‹è¯•(ä½¿ç”¨Clientæœºåˆ¶)

Djangoæä¾› test``Client``æ¨¡æ‹Ÿç”¨æˆ·ä¸è§†å›¾çš„äº¤äº’

å¯ä»¥åœ¨ test.py æˆ–shellä¸­ä½¿ç”¨

```python
>>  from django.test.utils import setup_test_environment
>>  setup_test_environment()//å®‰è£…ä¸€ä¸ªæ¨¡æ¿æ¸²æŸ“å™¨,ç”¨äºæ£€æŸ¥responseä¸­çš„é¢å¤–å±æ€§(å¦‚response.context)

>> from django.test import Client
>> # create an instance of the client for use
>> client = Client()
```

ğŸ¬ Clientç»“åˆæ¸²æŸ“å™¨é’ˆå¯¹responseçš„ç›¸å…³æ“ä½œ:

- **get a response from url '/'**
  - ``response = client.get('/')``
- **get status code**
  - ``response.status_code``
- **use reverse() to find a URL**
  - ``from django.urls import reverse``
  -  ``response = client.get(reverse('polss:index'))``
- get **response content**
  - ``response.content``
- get response **context**
  - ``response.context['latest_question_list']``

## æµ‹è¯•è¯•å›¾

### indexè§†å›¾æ”¹è¿›

views.py

```python
from django.utils import timezone
from django.urls import reverse
""" adding the filter for new index """
def index(request):
    latest_questions = Question.objects.filter
    (pub_date__lte=timezone.now()).
    order_by('-pub_date')[:3]
    context = {'latest_question_list': latest_questions}
    return render(request, 'polls/index.html', context)

```

#### indexè§†å›¾å®Œæ•´æµ‹è¯•

```python
from django.test import TestCase
import datetime
from django.utils import timezone
from .models import Question


class QuestionMethodTests(TestCase):

    def test_was_published_recently_old_question(self):
         # was_published_recently() should return False for
         # questions whose pub_date is older than 1 day.
         time = timezone.now() - datetime.timedelta(days=30)
         old_question = Question(pub_date=time)
         self.assertIs(old_question.was_published_recently(),
         False)

    def test_was_published_recently_recent_question(self):
         # was_published_recently() should return True for
         # questions whose pub_date is within the last day.
         time = timezone.now() - datetime.timedelta(hours=1)
         recent_question = Question(pub_date=time)
         self.assertIs(recent_question.
         was_published_recently(), True)

    def create_question(question_text, days):
         # creates a question given given question_text and
         # published the given number of days offset to now
         # (negative for past, positive for future)
         time = timezone.now() + datetime.timedelta(days=days)
         return Question.objects.create(
         question_text=question_text, pub_date=time)

class QuestionViewTests(TestCase):

     def test_index_view_with_no_questions(self):
         # If no questions exist, an appropriate message
         # should be displayed
         response = self.client.get(reverse('polls:index'))
         self.assertEqual(response.status_code, 200)
         self.assertContains(response, "No polls are
         available.")
         self.assertQuerysetEqual(response.context
         ['latest_question_list'], [])

     def test_index_view_with_a_past_question(self):
         # Only past questions published should be displayed
         create_question(question_text="Past question.",
         days=-30)
         response = self.client.get(reverse('polls:index'))
         self.assertQuerysetEqual(
         response.context['latest_question_list'],
         ['<Question: Past question.>'])
    def test_index_view_with_a_future_question(self):
         # Future questions should not be displayed
         create_question(question_text="Future question.",
         days=30)
         response = self.client.get(reverse('polls:index'))
         self.assertContains(response, "No polls are
         available.")
         self.assertQuerysetEqual(
         response.context['latest_question_list'], [])

    def test_index_view_with_future_question_and_past_question(self):
         # Even if both past and future questions exist,
         # only past questions should be displayed
         create_question(question_text="Past question.",
         days=-30)
         create_question(question_text="Future question.",
         days=30)
         response = self.client.get(reverse('polls:index'))
         self.assertQuerysetEqual(
         response.context['latest_question_list'],
         ['<Question: Past question.>'])
         
    def test_index_view_with_two_past_questions(self):
         # The questions index page may display multiple
         # questions.
         create_question(question_text="Past question 1.",
         days=-30)
         create_question(question_text="Past question 2.",
         days=-5)
         response = self.client.get(reverse('polls:index'))
         self.assertQuerysetEqual(
         response.context['latest_question_list'],
         ['<Question: Past question 2.>',
         '<Question: Past question 1.>']) 

```

### detail view

```python
""" æ·»åŠ äº†fileter """
def detail(request, question_id):
     question = get_object_or_404(Question.objects.filter(pub_date__lte=timezone.now()),
     pk=question_id)
     return render(request, 'polls/detail.html',
     {'question': question})
```

#### detail testç”¨ä¾‹

ç”¨äºtestä¸€ä¸ªQuestionå®ä¾‹,åŸºäºpub_dateåˆ¤æ–­æ˜¯å¦èƒ½è¢«displayed.

```python
class QuestionIndexDetailTests(TestCase):
    def test_detail_view_with_a_future_question(self):
        # The detail view of a question with a pub_date in
        # the future should return a 404 not found
        future_question = create_question(
        question_text='Future question.', days=5)
        url = reverse('polls:detail',
        args=(future_question.id,))
        response = self.client.get(url)
        self.assertEqual(response.status_code, 404) 
 ```

### å…³äºæµ‹è¯•

- å¯ä»¥åˆ©ç”¨ç±»ä¼¼filter()é’ˆå¯¹æŸviewåˆ›å»ºå…¶æµ‹è¯•ç”¨ä¾‹

- å‚è€ƒä»¥ä¸Šæµ‹è¯•ç”¨ä¾‹

- ![](/static/2020-02-21-18-25-23.png)

---

- æµ‹è¯•é›†ä¸å¿…è¿‡å¤§, æµ‹è¯•ä¾‹ä¸å¿…è¿‡å¤š

- å†—ä½™æµ‹è¯•ä¸å½±å“

- keep tests in arranged for managing.
    - æ¯ä¸ªè§†å›¾åˆ†é…ä¸€ä¸ªç‹¬ç«‹TestClasså­ç±»
    - é’ˆå¯¹æŸæ¡ä»¶ï¼ŒåŠŸèƒ½çš„ç‹¬ç«‹æµ‹è¯•æ–¹æ³•
    - æ˜“åˆ†è¾¨çš„æµ‹è¯•å

### é™æ€æ–‡ä»¶

#### æ·»åŠ css

- imgs, js , css
- ä¸ºproject æ–°å»ºstaticæ–‡ä»¶å¤¹&å­æ–‡ä»¶å¤¹polls,ç”¨äºå­˜æ”¾é™æ€æ–‡ä»¶
- åœ¨pollsæ–‡ä»¶å¤¹ä¸‹åˆ›å»º``style.css``æ–‡ä»¶

```css
    li a {
        color: green;
    }
```

åœ¨ index.html æ–‡ä»¶ä¸­åŠ è½½è¯¥é™æ€æ ·å¼ï¼Œæ³¨æ„ç»“åˆdjango template static å¼•æ“æ ‡ç­¾çš„ä½¿ç”¨

```html

<!-- markdownå†™ä¸è¿›ä¸Šé¢çš„æ ‡ç­¾ã€‚ã€‚è‡ªè¡Œæ·»åŠ -->

<link rel="stylesheet" type="text/css"
href="{ static 'polls/style.css' }" />

{% if latest_question_list %}
     <ul>
         {% for question in latest_question_list %}
             <li><a href="{% url 'polls:detail' question.id %}">{{ question.question_text }}</li>
         {% endfor %}
     </ul>
{% else %}
    <p>No polls are available.</p>
{% endif %}
```

![](/static/2020-02-21-18-32-40.png)

#### æ·»åŠ bg

static/pollsè·¯å¾„ä¸‹åˆ›å»ºimagesæ–‡ä»¶ï¼Œå­˜æ”¾é™æ€å›¾ç‰‡æ–‡ä»¶
- æ”¾å…¥ä¸€å¼ backgroundå›¾ç‰‡

æ–°åŠ cssæ ·å¼

```css
body {
 background: white
 url("images/background.jpg")
 no-repeat right bottom;
}
```

![](/static/2020-02-21-18-35-13.png)